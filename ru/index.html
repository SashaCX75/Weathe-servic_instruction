<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Погодный сервис (инструкция)</title>
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <!-- Подключение CSS для Prism.js -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      color: #333;
      line-height: 1.6;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background: #fff;
    }
    h1, h2 {
      color: #2c3e50;
    }
    ul {
      list-style-type: square;
      margin-left: 20px;
    }
    a {
      color: #3498db;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    /* Добавляем отступ для каждого параграфа */
    p {
      text-indent: 20px;
    }
    /* Стили для изображений */
    .image-container {
      display: flex;
      flex-wrap: wrap; /* Позволяет изображениям переноситься на новую строку */
      justify-content: center; /* Выравнивает изображения по центру */
      gap: 20px; /* Добавляет отступы между изображениями */
      margin: 20px 0;
    }
    .image-container img {
      width: auto;
      height: 300px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .single-image-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .single-image-container img {
      width: auto;
      height: 300px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .image-container img:hover {
      transform: scale(1.05);
    }
    .single-image-container img:hover {
      transform: scale(1.05);
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
    }
    .modal.active {
      display: flex;
    }
    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: white;
      color: black;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      line-height: 40px;
      text-align: center;
    }
    .language-switch {
      margin: 10px 0;
      text-align: right;
    }
    .language-switch a {
      padding: 8px 16px;
      font-size: 16px;
      background-color: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      display: inline-flex;
      align-items: center;
    }
    .language-switch a:hover {
      background-color: #2980b9;
    }
    .language-switch img {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
  </style>
</head>
<body>

  <!-- Language Switch Button -->
  <div class="language-switch">
    <a href="../en/index.html">
      <img src="images/language.svg" alt="Switch language icon"> English
    </a>
  </div>

  <h1>Погодный сервис</h1>
  
  <h2>Описание</h2>
  <p>Добро пожаловать в приложение «Погодный сервис»! Это приложение предоставляет информацию о погоде в городах по всему миру в режиме реального времени позволяя вам выбирать источники откуда получать информацию.</p>
  
  <!-- Images side by side -->
  <div class="image-container">
    <img src="images/clouds.gif" alt="Overview of Weather App 1" class="open-modal" data-modal="modal_img_app_1">
    <img src="images/Interface.gif" alt="Overview of Weather App 2" class="open-modal" data-modal="modal_img_app_2">
  </div>
  <p>Приложение задумывалось как промежуточное звено между погодным сервером и циферблатами. Поэтому оно может работать в фоне и записывать данные в файл, доступный для циферблатов. К сожалению, так как время работы в фоне ограничено, оно не всегда успевает получить и обработать данные от сервера.</p>

  <h2>Установка и настройка</h2>
  <p>После установки приложения на часах запустите приложение и зайдите в настройки. Если нет сообщения о том, что настройки синхронизировались это значит, что app-side часть приложения работает некорректно. Обычно помогает перезагрузка Zepp или перезагрузка телефона.</p>
  <!-- Single centered image -->
  <div class="single-image-container">
    <img src="images/synchronisation.png" alt="Synchronisation settings" class="open-modal" data-modal="modal_synchronisation">
  </div>
  <p>Координаты города можно определить на часах на странице настроек (долго и не работает в помещении), а можно на телефоне (в настройках в приложении Zepp). Если вы определили координаты в телефоне, то для того, чтобы изменения вступили в силу, необходимо зайти в настройки приложения на часах.</p>
  <div class="image-container">
    <img src="images/settings_app_1.png" alt="Settings App 1" class="open-modal" data-modal="modal_img_settings_app_1">
    <img src="images/settings_app_2.png" alt="Settings App 2" class="open-modal" data-modal="modal_img_settings_app_2">
    <img src="images/Settings_Zepp.png" alt="Settings Zepp" class="open-modal" data-modal="modal_img_settings_zepp">
  </div>
  
  <h2>Использование приложения</h2>
  <p>На странице настроек приложения можно выбрать источник откуда получать данные погоды. Обратите внимание что разные источники погоды предоставляют разный набор данных погоды. Для некоторых источников нужно зарегистрироваться на сайте и получить ключ.</p>
  <ul>
      <li><a href="https://home.openweathermap.org/api_keys" target="_blank">Api key OpenWeather</a></li>
      <li><a href="https://developer.accuweather.com/user/me/apps" target="_blank">Api key AccuWeather</a></li>
    </ul>
  <p>Если вы не используете циферблат, который получает данные от этого приложения, то не нужно включать обновление данных в фоне.</p>
  <p>Данные погоды обновляются в таких случаях:</p>
  <ul>
    <li>при изменении координат или сервера погоды.</li>
    <li>при запуске приложения (но не чаще чем раз в 15 минут).</li>
    <li>при работе в фоне (погода 1 раз в час, прогноз 1 раз в 3 часа).</li>
  </ul>
  
  <h2>Использование данных приложения в циферблатах</h2>
  <p>Для того, чтобы использовать данные приложения в своем циферблате вы должны загрузить json файл с данными, сохраненный в приложении. Это можно сделать при помощи такой функции:</p>

  <!-- JavaScript Code Block with Prism.js -->
  <pre><code class="language-javascript">
function read_weather_file() {
  let str_result = "";
  try {
    const file_name = "weather.json";
    const mini_app_id = 1042817;

    const [fs_stat, err] = hmFS.stat(file_name, {
      appid: mini_app_id,
    });
    if (err == 0) {
      console.log("--->size_alt:", fs_stat.size);

      const fh = hmFS.open(file_name, hmFS.O_RDONLY, {
        appid: mini_app_id,
      });

      const len = fs_stat.size;
      let array_buffer = new ArrayBuffer(len);
      hmFS.read(fh, array_buffer, 0, len);
      hmFS.close(fh);
      str_result = arrayBufferToCyrillic(array_buffer);
      console.log(`array_buffer = ${array_buffer}`);
      console.log(`str_result = ${str_result}`);
      return str_result;
    } else {
      console.log("err:", err);
    }
  } catch (error) {
    console.log("error:", error);
    console.log("FAIL: No access to hmFS.");
  }
  return "";
}
  </code></pre>
  
  <p>file_name = "weather.json" –  для данных текущей погоды.</p>
  <p>file_name = "forecast.json" –  для данных прогноза погоды.</p>
  <p>В зависимости от выбранного сайта данные в прогнозе могут начинаться с текущего дня или с завтрашнего дня. Обязательно проверяйте дату при отображении прогноза.</p>
  <p>Также рекомендуется проверять время обновления данных чтобы убедиться, что они не устарели. Время обновления есть в самом файле, а также можно в свойствах файла узнать время его изменения.</p>
  <p>О структуре json файлов и имеющихся в них параметрах можно узнать в документации.</p>

  <div class="documentation-links">
    <h2>Ссылки на документацию и примеры</h2>
    <p>Обратитесь к следующей документации для получения дополнительной помощи:</p>
    <ul>
      <li><a href="files/Данные погоды.xlsx" target="_blank">Параметры json файлов с данными</a></li>
      <li><a href="files/Иконки погоды.xlsx" target="_blank">Обозначения иконок погоды (параметр weatherIcon)</a></li>
      <li><a href="files/Meteo.zip" target="_blank">Пример циферблата, использующего данные приложения (автор leXxiR)</a></li>
      <li><a href="https://github.com/SashaCX75/Weather-service" target="_blank">Исходный код приложения</a></li>
    </ul>
  </div>

  <!-- Modals for images -->
  <div id="modal_img_app_1" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/clouds.gif" alt="Full-size Overview of Weather App 1">
  </div>
  <div id="modal_img_app_2" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/Interface.gif" alt="Full-size Overview of Weather App 2">
  </div>
  
  <div id="modal_synchronisation" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/synchronisation.png" alt="Full-size Overview of Weather App 2">
  </div>
  
  <div id="modal_img_settings_app_1" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/settings_app_1.png" alt="Full-size Overview of Weather App 2">
  </div>
  <div id="modal_img_settings_app_2" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/settings_app_2.png" alt="Full-size Overview of Weather App 2">
  </div>
  <div id="modal_img_settings_zepp" class="modal">
    <button class="modal-close">&times;</button>
    <img src="images/Settings_Zepp.png" alt="Full-size Overview of Weather App 2">
  </div>

  <!-- Подключение JS для Prism.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js"></script>

  <script>
    // Открытие модального окна
    document.querySelectorAll('.open-modal').forEach(image => {
      image.addEventListener('click', () => {
        const modalId = image.getAttribute('data-modal');
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('active');
        }
      });
    });

    // Закрытие модального окна
    document.querySelectorAll('.modal-close').forEach(button => {
      button.addEventListener('click', () => {
        const modal = button.closest('.modal');
        if (modal) {
          modal.classList.remove('active');
        }
      });
    });

    // Закрытие модального окна при клике вне изображения
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (event) => {
        if (event.target === modal) {
          modal.classList.remove('active');
        }
      });
    });
  </script>
  
</body>
</html>

